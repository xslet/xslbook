<?xml version="1.0" encoding="UTF-8"?><!-- xslbook.xsl v0.1. Copyright (C) xslet@github. MIT License --><xsl:stylesheet xmlns:ut="https://github.com/xslet/2020/xslutil" xmlns:do="https://github.com/xslet/2020/xsldo" xmlns:bk="https://github.com/xslet/2020/xslbook" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0"><xsl:param name="bk:xsl_url"><xsl:call-template name="ut:get_xsl_url"/></xsl:param><xsl:param name="bk:xsl_dir"><xsl:call-template name="ut:get_dir_from_url"><xsl:with-param name="url" select="$bk:xsl_url"/></xsl:call-template></xsl:param><xsl:param name="ut:apos">'</xsl:param><xsl:param name="ut:quot">"</xsl:param><xsl:param name="ut:true" select="string(true())"/><xsl:param name="ut:unknown_namespace">&#x86;-&#x87;</xsl:param><xsl:param name="do:_path_sep">&#x86;/&#x87;</xsl:param><xsl:param name="do:_ns_sep">&#x86;:&#x87;</xsl:param><xsl:param name="do:_cond_sep">&#x86;?&#x87;</xsl:param><xsl:param name="do:_cond_or_sep">&#x96;|&#x97;</xsl:param><xsl:param name="do:_cond_and_sep">&#x96;,&#x97;</xsl:param><xsl:param name="do:_cond_path_sep">&#x96;/&#x97;</xsl:param><xsl:param name="do:_cond_op_sep">&#x96;=&#x97;</xsl:param><xsl:param name="do:_object_sep">&#x86;;&#x87;</xsl:param><xsl:template match="p|br|hr|b|i|u|s|code|sup|sub|q"><xsl:param name="data_url"/><xsl:param name="data_gid"/><xsl:param name="allow_text_node" select="$ut:true"/><xsl:param name="deny">|attr|</xsl:param><xsl:param name="arg0"/><xsl:param name="arg1"/><xsl:param name="arg2"/><xsl:variable name="_data_url"><xsl:call-template name="bk:get_data_url"><xsl:with-param name="data_url" select="$data_url"/></xsl:call-template></xsl:variable><xsl:variable name="_data_gid"><xsl:call-template name="bk:get_data_gid"><xsl:with-param name="data_gid" select="$data_gid"/></xsl:call-template></xsl:variable><xsl:element name="{name()}"><xsl:for-each select="attribute::*"><xsl:attribute name="{name()}"><xsl:value-of select="."/></xsl:attribute></xsl:for-each><xsl:for-each select="attr"><xsl:attribute name="{@name}"><xsl:apply-templates><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/></xsl:apply-templates></xsl:attribute></xsl:for-each><xsl:apply-templates select="node()[name()!='attr']"><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/></xsl:apply-templates></xsl:element></xsl:template><xsl:template match="bar"><span class="bar">───</span></xsl:template><xsl:template match="dots"><span class="dots">･･････</span></xsl:template><xsl:template match="/book|/xslbook"><xsl:variable name="_data_url"><xsl:call-template name="bk:get_data_url"/></xsl:variable><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta http-equiv="X-UA-Compatible" content="ie=edge"/><title><xsl:apply-templates select="title"><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="allow">|title|for|if|case|</xsl:with-param><xsl:with-param name="allow_text_node"/></xsl:apply-templates></title><xsl:call-template name="bk:_load_default_script"/><xsl:apply-templates select="script"/><xsl:call-template name="bk:_load_default_css"/><xsl:apply-templates select="css"/></head><body><main><header/><article class="book"><xsl:apply-templates select="title|for|if|case"><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="allow">|title|for|if|case|</xsl:with-param><xsl:with-param name="allow_text_node"/><xsl:with-param name="arg0">h1</xsl:with-param></xsl:apply-templates><div class="body"><xsl:apply-templates select="body"><xsl:with-param name="data_url" select="$_data_url"/></xsl:apply-templates></div></article><footer/></main></body></html></xsl:template><xsl:template name="bk:_load_default_script"><script src="{concat($bk:xsl_dir, '/xslbook.js')}"/></xsl:template><xsl:template name="bk:_load_default_css"><link rel="stylesheet" href="{concat($bk:xsl_dir, '/xslbook.css')}"/></xsl:template><xsl:template match="title"><xsl:param name="data_url"/><xsl:param name="data_gid"/><xsl:param name="allow"/><xsl:param name="arg0"/><xsl:param name="arg1"/><xsl:param name="arg2"/><xsl:variable name="_data_url"><xsl:call-template name="bk:get_data_url"><xsl:with-param name="data_url" select="$data_url"/></xsl:call-template></xsl:variable><xsl:variable name="_data_gid"><xsl:call-template name="bk:get_data_gid"><xsl:with-param name="data_gid" select="$data_gid"/></xsl:call-template></xsl:variable><xsl:choose><xsl:when test="string-length($arg0) != 0"><xsl:element name="{$arg0}"><xsl:apply-templates><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/><xsl:with-param name="arg0"/><xsl:with-param name="arg1" select="$arg1"/><xsl:with-param name="arg2" select="$arg2"/></xsl:apply-templates></xsl:element></xsl:when><xsl:otherwise><xsl:apply-templates><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/><xsl:with-param name="arg0"/><xsl:with-param name="arg1" select="$arg1"/><xsl:with-param name="arg2" select="$arg2"/></xsl:apply-templates></xsl:otherwise></xsl:choose></xsl:template><xsl:template match="body"><xsl:param name="data_url"/><xsl:param name="data_gid"/><xsl:param name="allow"/><xsl:param name="allow_text_node"/><xsl:param name="arg0"/><xsl:param name="arg1"/><xsl:param name="arg2"/><xsl:variable name="_data_url"><xsl:call-template name="bk:get_data_url"><xsl:with-param name="data_url" select="$data_url"/></xsl:call-template></xsl:variable><xsl:variable name="_data_gid"><xsl:call-template name="bk:get_data_gid"><xsl:with-param name="data_gid" select="$data_gid"/></xsl:call-template></xsl:variable><xsl:apply-templates><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/><xsl:with-param name="allow" select="$allow"/><xsl:with-param name="allow_text_node" select="$allow_text_node"/><xsl:with-param name="arg0" select="$arg0"/><xsl:with-param name="arg1" select="$arg1"/><xsl:with-param name="arg2" select="$arg2"/></xsl:apply-templates></xsl:template><xsl:template match="/book/script|/xslbook/script"><xsl:choose><xsl:when test="boolean(@href)"><script src="{@href}"/></xsl:when><xsl:when test="boolean(@rpath)"><script src="{concat($bk:xsl_dir, '/', @rpath)}"/></xsl:when></xsl:choose></xsl:template><xsl:template match="/book/css|/xslbook/css"><xsl:choose><xsl:when test="boolean(@href)"><link rel="stylesheet" href="{@href}"/></xsl:when><xsl:when test="boolean(@rpath)"><link rel="stylesheet" href="{concat($bk:xsl_dir, '/', @rpath)}"/></xsl:when></xsl:choose></xsl:template><xsl:template match="count"><xsl:param name="data_url"/><xsl:param name="data_gid"/><xsl:variable name="_data_url"><xsl:call-template name="bk:get_data_url"><xsl:with-param name="data_url" select="$data_url"/></xsl:call-template></xsl:variable><xsl:variable name="_data_gid"><xsl:call-template name="bk:get_data_gid"><xsl:with-param name="data_gid" select="$data_gid"/></xsl:call-template></xsl:variable><xsl:variable name="_path"><xsl:call-template name="bk:get_attribute"><xsl:with-param name="name">of</xsl:with-param><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/></xsl:call-template></xsl:variable><xsl:variable name="_prefix"><xsl:call-template name="bk:get_attribute"><xsl:with-param name="name">prefix</xsl:with-param><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/></xsl:call-template></xsl:variable><xsl:variable name="_suffix"><xsl:call-template name="bk:get_attribute"><xsl:with-param name="name">suffix</xsl:with-param><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/></xsl:call-template></xsl:variable><xsl:call-template name="do:count_nodes_by_path"><xsl:with-param name="path" select="$_path"/><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/><xsl:with-param name="prefix" select="$_prefix"/><xsl:with-param name="suffix" select="$_suffix"/></xsl:call-template></xsl:template><xsl:template name="bk:get_data_url"><xsl:param name="data_url"/><xsl:choose><xsl:when test="boolean(@data-src)"><xsl:value-of select="@data-src"/></xsl:when><xsl:otherwise><xsl:value-of select="$data_url"/></xsl:otherwise></xsl:choose></xsl:template><xsl:template name="bk:get_data_gid"><xsl:param name="data_gid"/><xsl:if test="not(boolean(@data-src))"><xsl:value-of select="$data_gid"/></xsl:if></xsl:template><xsl:template match="if"><xsl:param name="data_url"/><xsl:param name="data_gid"/><xsl:param name="allow"/><xsl:param name="allow_text_node"/><xsl:param name="arg0"/><xsl:param name="arg1"/><xsl:param name="arg2"/><xsl:variable name="_data_url"><xsl:call-template name="bk:get_data_url"><xsl:with-param name="data_url" select="$data_url"/></xsl:call-template></xsl:variable><xsl:variable name="_data_gid"><xsl:call-template name="bk:get_data_gid"><xsl:with-param name="data_gid" select="$data_gid"/></xsl:call-template></xsl:variable><xsl:variable name="_path"><xsl:call-template name="bk:get_attribute"><xsl:with-param name="name">of</xsl:with-param><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/></xsl:call-template></xsl:variable><xsl:variable name="_test"><xsl:call-template name="bk:get_attribute"><xsl:with-param name="name">test</xsl:with-param><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/></xsl:call-template></xsl:variable><xsl:variable name="_eq"><xsl:call-template name="bk:get_attribute"><xsl:with-param name="name">eq</xsl:with-param><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/></xsl:call-template></xsl:variable><xsl:variable name="_ne"><xsl:call-template name="bk:get_attribute"><xsl:with-param name="name">ne</xsl:with-param><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/></xsl:call-template></xsl:variable><xsl:variable name="_le"><xsl:call-template name="bk:get_attribute"><xsl:with-param name="name">le</xsl:with-param><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/></xsl:call-template></xsl:variable><xsl:variable name="_lt"><xsl:call-template name="bk:get_attribute"><xsl:with-param name="name">lt</xsl:with-param><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/></xsl:call-template></xsl:variable><xsl:variable name="_ge"><xsl:call-template name="bk:get_attribute"><xsl:with-param name="name">ge</xsl:with-param><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/></xsl:call-template></xsl:variable><xsl:variable name="_gt"><xsl:call-template name="bk:get_attribute"><xsl:with-param name="name">gt</xsl:with-param><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/></xsl:call-template></xsl:variable><xsl:variable name="_is_matched"><xsl:choose><xsl:when test="string-length($_path) != 0"><xsl:variable name="_content"><xsl:call-template name="do:first_object_by_path"><xsl:with-param name="path" select="$_path"/><xsl:with-param name="what">content</xsl:with-param><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/></xsl:call-template></xsl:variable><xsl:variable name="_is_not_matched"><xsl:if test="string-length($_eq) != 0 and not($_content = $_eq)">1</xsl:if><xsl:if test="string-length($_ne) != 0 and not($_content != $_ne)">1</xsl:if><xsl:if test="string-length($_le) != 0 and not($_content &lt;= $_le)">1</xsl:if><xsl:if test="string-length($_lt) != 0 and not($_content &lt; $_eq)">1</xsl:if><xsl:if test="string-length($_ge) != 0 and not($_content &gt;= $_ge)">1</xsl:if><xsl:if test="string-length($_gt) != 0 and not($_content &gt; $_gt)">1</xsl:if></xsl:variable><xsl:value-of select="string-length($_is_not_matched) = 0"/></xsl:when><xsl:otherwise><xsl:call-template name="do:match_condition_by_path"><xsl:with-param name="condition" select="$_test"/><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/></xsl:call-template></xsl:otherwise></xsl:choose></xsl:variable><xsl:choose><xsl:when test="$_is_matched = $ut:true"><xsl:call-template name="do:for_times"><xsl:with-param name="times" select="1"/><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/><xsl:with-param name="allow" select="$allow"/><xsl:with-param name="allow_text_node" select="$allow_text_node"/><xsl:with-param name="deny">|attr|else|</xsl:with-param><xsl:with-param name="arg0" select="$arg0"/><xsl:with-param name="arg1" select="$arg1"/><xsl:with-param name="arg2" select="$arg2"/></xsl:call-template></xsl:when><xsl:when test="boolean(else)"><xsl:for-each select="else"><xsl:call-template name="do:for_times"><xsl:with-param name="times" select="1"/><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/><xsl:with-param name="allow" select="$allow"/><xsl:with-param name="allow_text_node" select="$allow_text_node"/><xsl:with-param name="deny">|attr|else|</xsl:with-param><xsl:with-param name="arg0" select="$arg0"/><xsl:with-param name="arg1" select="$arg1"/><xsl:with-param name="arg2" select="$arg2"/></xsl:call-template></xsl:for-each></xsl:when></xsl:choose></xsl:template><xsl:template name="bk:get_attribute"><xsl:param name="name"/><xsl:param name="data_url"/><xsl:param name="data_gid"/><xsl:param name="arg0"/><xsl:param name="arg1"/><xsl:param name="arg2"/><xsl:variable name="_data_url"><xsl:call-template name="bk:get_data_url"><xsl:with-param name="data_url" select="$data_url"/></xsl:call-template></xsl:variable><xsl:variable name="_data_gid"><xsl:call-template name="bk:get_data_gid"><xsl:with-param name="data_gid" select="$data_gid"/></xsl:call-template></xsl:variable><xsl:choose><xsl:when test="@*[name()=$name]"><xsl:value-of select="@*[name()=$name]"/></xsl:when><xsl:when test="boolean(attr[@name=$name])"><xsl:apply-templates select="attr[@name=$name]"><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/><xsl:with-param name="arg0" select="$arg0"/><xsl:with-param name="arg1" select="$arg1"/><xsl:with-param name="arg2" select="$arg2"/></xsl:apply-templates></xsl:when></xsl:choose></xsl:template><xsl:template match="name"><xsl:param name="data_url"/><xsl:param name="data_gid"/><xsl:variable name="_data_url"><xsl:call-template name="bk:get_data_url"><xsl:with-param name="data_url" select="$data_url"/></xsl:call-template></xsl:variable><xsl:variable name="_data_gid"><xsl:call-template name="bk:get_data_gid"><xsl:with-param name="data_gid" select="$data_gid"/></xsl:call-template></xsl:variable><xsl:variable name="_path"><xsl:call-template name="bk:get_attribute"><xsl:with-param name="name">of</xsl:with-param><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/></xsl:call-template></xsl:variable><xsl:variable name="_prefix"><xsl:call-template name="bk:get_attribute"><xsl:with-param name="name">prefix</xsl:with-param><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/></xsl:call-template></xsl:variable><xsl:variable name="_suffix"><xsl:call-template name="bk:get_attribute"><xsl:with-param name="name">suffix</xsl:with-param><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/></xsl:call-template></xsl:variable><xsl:call-template name="do:first_object_by_path"><xsl:with-param name="path" select="$_path"/><xsl:with-param name="what">name</xsl:with-param><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/><xsl:with-param name="prefix" select="$_prefix"/><xsl:with-param name="suffix" select="$_suffix"/></xsl:call-template></xsl:template><xsl:template match="number"><xsl:param name="data_url"/><xsl:param name="data_gid"/><xsl:variable name="_data_url"><xsl:call-template name="bk:get_data_url"><xsl:with-param name="data_url" select="$data_url"/></xsl:call-template></xsl:variable><xsl:variable name="_data_gid"><xsl:call-template name="bk:get_data_gid"><xsl:with-param name="data_gid" select="$data_gid"/></xsl:call-template></xsl:variable><xsl:variable name="_path"><xsl:call-template name="bk:get_attribute"><xsl:with-param name="name">of</xsl:with-param><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/></xsl:call-template></xsl:variable><xsl:variable name="_prefix"><xsl:call-template name="bk:get_attribute"><xsl:with-param name="name">prefix</xsl:with-param><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/></xsl:call-template></xsl:variable><xsl:variable name="_suffix"><xsl:call-template name="bk:get_attribute"><xsl:with-param name="name">suffix</xsl:with-param><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/></xsl:call-template></xsl:variable><xsl:call-template name="do:first_object_by_path"><xsl:with-param name="path" select="$_path"/><xsl:with-param name="what">number</xsl:with-param><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/><xsl:with-param name="prefix" select="$_prefix"/><xsl:with-param name="suffix" select="$_suffix"/></xsl:call-template></xsl:template><xsl:template match="for"><xsl:param name="data_url"/><xsl:param name="data_gid"/><xsl:param name="allow"/><xsl:param name="allow_text_node"/><xsl:param name="deny"/><xsl:param name="arg0"/><xsl:param name="arg1"/><xsl:param name="arg2"/><xsl:variable name="_data_url"><xsl:call-template name="bk:get_data_url"><xsl:with-param name="data_url" select="$data_url"/></xsl:call-template></xsl:variable><xsl:variable name="_data_gid"><xsl:call-template name="bk:get_data_gid"><xsl:with-param name="data_gid" select="$data_gid"/></xsl:call-template></xsl:variable><xsl:variable name="_path"><xsl:call-template name="bk:get_attribute"><xsl:with-param name="name">each</xsl:with-param><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/></xsl:call-template></xsl:variable><xsl:variable name="_times"><xsl:call-template name="bk:get_attribute"><xsl:with-param name="name">times</xsl:with-param><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/></xsl:call-template></xsl:variable><xsl:choose><xsl:when test="string-length($_times) != 0"><xsl:call-template name="do:for_times"><xsl:with-param name="times" select="$_times"/><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/><xsl:with-param name="allow" select="$allow"/><xsl:with-param name="allow_text_node" select="$allow_text_node"/><xsl:with-param name="deny" select="'|attr|'"/><xsl:with-param name="arg0" select="$arg0"/><xsl:with-param name="arg1" select="$arg1"/><xsl:with-param name="arg2" select="$arg2"/></xsl:call-template></xsl:when><xsl:otherwise><xsl:call-template name="do:for_by_path"><xsl:with-param name="path" select="$_path"/><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/><xsl:with-param name="allow" select="$allow"/><xsl:with-param name="allow_text_node" select="$allow_text_node"/><xsl:with-param name="deny" select="'|attr|'"/><xsl:with-param name="arg0" select="$arg0"/><xsl:with-param name="arg1" select="$arg1"/><xsl:with-param name="arg2" select="$arg2"/></xsl:call-template></xsl:otherwise></xsl:choose></xsl:template><xsl:template match="content"><xsl:param name="data_url"/><xsl:param name="data_gid"/><xsl:variable name="_data_url"><xsl:call-template name="bk:get_data_url"><xsl:with-param name="data_url" select="$data_url"/></xsl:call-template></xsl:variable><xsl:variable name="_data_gid"><xsl:call-template name="bk:get_data_gid"><xsl:with-param name="data_gid" select="$data_gid"/></xsl:call-template></xsl:variable><xsl:variable name="_path"><xsl:call-template name="bk:get_attribute"><xsl:with-param name="name">of</xsl:with-param><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/></xsl:call-template></xsl:variable><xsl:variable name="_prefix"><xsl:call-template name="bk:get_attribute"><xsl:with-param name="name">prefix</xsl:with-param><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/></xsl:call-template></xsl:variable><xsl:variable name="_suffix"><xsl:call-template name="bk:get_attribute"><xsl:with-param name="name">suffix</xsl:with-param><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/></xsl:call-template></xsl:variable><xsl:call-template name="do:first_object_by_path"><xsl:with-param name="path" select="$_path"/><xsl:with-param name="what">content</xsl:with-param><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/><xsl:with-param name="prefix" select="$_prefix"/><xsl:with-param name="suffix" select="$_suffix"/></xsl:call-template></xsl:template><xsl:template match="value"><xsl:param name="data_url"/><xsl:param name="data_gid"/><xsl:variable name="_data_url"><xsl:call-template name="bk:get_data_url"><xsl:with-param name="data_url" select="$data_url"/></xsl:call-template></xsl:variable><xsl:variable name="_data_gid"><xsl:call-template name="bk:get_data_gid"><xsl:with-param name="data_gid" select="$data_gid"/></xsl:call-template></xsl:variable><xsl:variable name="_path"><xsl:call-template name="bk:get_attribute"><xsl:with-param name="name">of</xsl:with-param><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/></xsl:call-template></xsl:variable><xsl:variable name="_prefix"><xsl:call-template name="bk:get_attribute"><xsl:with-param name="name">prefix</xsl:with-param><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/></xsl:call-template></xsl:variable><xsl:variable name="_suffix"><xsl:call-template name="bk:get_attribute"><xsl:with-param name="name">suffix</xsl:with-param><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/></xsl:call-template></xsl:variable><xsl:call-template name="do:first_object_by_path"><xsl:with-param name="path" select="$_path"/><xsl:with-param name="what">text</xsl:with-param><xsl:with-param name="data_url" select="$_data_url"/><xsl:with-param name="data_gid" select="$_data_gid"/><xsl:with-param name="prefix" select="$_prefix"/><xsl:with-param name="suffix" select="$_suffix"/></xsl:call-template></xsl:template><xsl:template name="ut:count"><xsl:param name="string"/><xsl:param name="target"/><xsl:choose><xsl:when test="string-length($string) = 0">0</xsl:when><xsl:when test="string-length($target) = 0">0</xsl:when><xsl:when test="starts-with($string, $target)"><xsl:variable name="_count"><xsl:variable name="_next_bgn" select="string-length($target) + 1"/><xsl:call-template name="ut:count"><xsl:with-param name="string" select="substring($string, $_next_bgn)"/><xsl:with-param name="target" select="$target"/></xsl:call-template></xsl:variable><xsl:value-of select="$_count + 1"/></xsl:when><xsl:otherwise><xsl:call-template name="ut:count"><xsl:with-param name="string" select="substring($string, 2)"/><xsl:with-param name="target" select="$target"/></xsl:call-template></xsl:otherwise></xsl:choose></xsl:template><xsl:template name="ut:ends_with"><xsl:param name="string"/><xsl:param name="suffix"/><xsl:variable name="_len1" select="string-length($suffix)"/><xsl:choose><xsl:when test="$_len1 = 0"><xsl:value-of select="$ut:true"/></xsl:when><xsl:otherwise><xsl:variable name="_len0" select="string-length($string)"/><xsl:variable name="_len2" select="$_len0 - $_len1"/><xsl:variable name="_ends" select="substring($string, $_len2 + 1)"/><xsl:if test="$_ends = $suffix"><xsl:value-of select="$ut:true"/></xsl:if></xsl:otherwise></xsl:choose></xsl:template><xsl:template name="ut:get_dir_from_url"><xsl:param name="url"/><xsl:choose><xsl:when test="not(contains($url, '/'))">.</xsl:when><xsl:otherwise><xsl:call-template name="ut:_get_dir_from_url_r"><xsl:with-param name="url" select="$url"/></xsl:call-template></xsl:otherwise></xsl:choose></xsl:template><xsl:template name="ut:_get_dir_from_url_r"><xsl:param name="url"/><xsl:value-of select="substring-before($url, '/')"/><xsl:variable name="suburl" select="substring-after($url, '/')"/><xsl:if test="string-length($suburl) &gt; 0"><xsl:variable name="subdir"><xsl:call-template name="ut:_get_dir_from_url_r"><xsl:with-param name="url" select="$suburl"/></xsl:call-template></xsl:variable><xsl:if test="string-length($subdir) &gt; 0"><xsl:value-of select="concat('/', $subdir)"/></xsl:if></xsl:if></xsl:template><xsl:template name="ut:get_namespace_uri"><xsl:param name="prefix"/><xsl:variable name="_ns" select="namespace::*[name() = $prefix]"/><xsl:choose><xsl:when test="string-length($_ns) &gt; 0"><xsl:value-of select="$_ns"/></xsl:when><xsl:otherwise><xsl:variable name="_ns2" select="namespace-uri(//*[name() = concat($prefix,':',local-name())])"/><xsl:choose><xsl:when test="string-length($_ns2) &gt; 0"><xsl:value-of select="$_ns2"/></xsl:when><xsl:when test="string-length($prefix) &gt; 0"><xsl:value-of select="$ut:unknown_namespace"/></xsl:when></xsl:choose></xsl:otherwise></xsl:choose></xsl:template><xsl:template name="ut:get_xsl_url"><xsl:param name="pi" select="/processing-instruction('xml-stylesheet')"/><xsl:variable name="QUOT">"</xsl:variable><xsl:variable name="APOS">'</xsl:variable><xsl:variable name="s1" select="substring-after($pi, 'href')"/><xsl:if test="normalize-space(substring-before($s1, '=')) = ''"><xsl:variable name="s2" select="substring-after($s1, '=')"/><xsl:choose><xsl:when test="substring($s2, 1, 1) = $QUOT"><xsl:value-of select="translate(substring-before(substring-after($s2, $QUOT), $QUOT), '\', '/')"/></xsl:when><xsl:when test="substring($s2, 1, 1) = $APOS"><xsl:value-of select="translate(substring-before(substring-after($s2, $APOS), $APOS), '\', '/')"/></xsl:when><xsl:otherwise><xsl:variable name="s3" select="normalize-space($s2)"/><xsl:choose><xsl:when test="substring($s3, 1, 1) = $QUOT"><xsl:value-of select="translate(substring-before(substring-after($s2, $QUOT), $QUOT), '\', '/')"/></xsl:when><xsl:when test="substring($s3, 1, 1) = $APOS"><xsl:value-of select="translate(substring-before(substring-after($s2, $APOS), $APOS), '\', '/')"/></xsl:when></xsl:choose></xsl:otherwise></xsl:choose></xsl:if></xsl:template><xsl:template name="ut:is_absolute_url"><xsl:param name="url"/><xsl:choose><xsl:when test="string-length($url) = 0"><xsl:value-of select="$ut:true"/></xsl:when><xsl:when test="contains($url, ':')"><xsl:value-of select="$ut:true"/></xsl:when><xsl:when test="starts-with($url, '/')"><xsl:value-of select="$ut:true"/></xsl:when></xsl:choose></xsl:template><xsl:template name="ut:repeat"><xsl:param name="string"/><xsl:param name="count"/><xsl:if test="$count &gt; 0"><xsl:value-of select="$string"/><xsl:call-template name="ut:repeat"><xsl:with-param name="string" select="$string"/><xsl:with-param name="count" select="$count - 1"/></xsl:call-template></xsl:if></xsl:template><xsl:template name="ut:replace"><xsl:param name="string"/><xsl:param name="target"/><xsl:param name="replacement"/><xsl:variable name="_lenT" select="string-length($target)"/><xsl:choose><xsl:when test="$_lenT = 0"><xsl:value-of select="$string"/></xsl:when><xsl:when test="starts-with($string, $target)"><xsl:value-of select="$replacement"/><xsl:call-template name="ut:replace"><xsl:with-param name="string" select="substring($string, $_lenT + 1)"/><xsl:with-param name="target" select="$target"/><xsl:with-param name="replacement" select="$replacement"/></xsl:call-template></xsl:when><xsl:otherwise><xsl:variable name="_before" select="substring-before($string, $target)"/><xsl:choose><xsl:when test="$_before = ''"><xsl:value-of select="$string"/></xsl:when><xsl:otherwise><xsl:variable name="_lenB" select="string-length($_before)"/><xsl:variable name="_posA" select="$_lenB + $_lenT + 1"/><xsl:value-of select="$_before"/><xsl:value-of select="$replacement"/><xsl:call-template name="ut:replace"><xsl:with-param name="string" select="substring($string, $_posA)"/><xsl:with-param name="target" select="$target"/><xsl:with-param name="replacement" select="$replacement"/></xsl:call-template></xsl:otherwise></xsl:choose></xsl:otherwise></xsl:choose></xsl:template><xsl:template name="ut:trim_start"><xsl:param name="string"/><xsl:param name="target"/><xsl:variable name="_lenS" select="string-length($string)"/><xsl:variable name="_lenT" select="string-length($target)"/><xsl:choose><xsl:when test="$_lenS = 0"/><xsl:when test="$_lenT = 0"><xsl:variable name="_first" select="substring($string, 1, 1)"/><xsl:choose><xsl:when test="normalize-space($_first) = ''"><xsl:call-template name="ut:trim_start"><xsl:with-param name="string" select="substring($string, 2)"/></xsl:call-template></xsl:when><xsl:otherwise><xsl:value-of select="$string"/></xsl:otherwise></xsl:choose></xsl:when><xsl:otherwise><xsl:choose><xsl:when test="starts-with($string, $target)"><xsl:call-template name="ut:trim_start"><xsl:with-param name="string" select="substring($string, $_lenT + 1)"/><xsl:with-param name="target" select="$target"/></xsl:call-template></xsl:when><xsl:otherwise><xsl:value-of select="$string"/></xsl:otherwise></xsl:choose></xsl:otherwise></xsl:choose></xsl:template><xsl:template name="ut:trim_end"><xsl:param name="string"/><xsl:param name="target"/><xsl:variable name="_lenS" select="string-length($string)"/><xsl:variable name="_lenT" select="string-length($target)"/><xsl:choose><xsl:when test="$_lenS = 0"/><xsl:when test="$_lenT = 0"><xsl:variable name="_last" select="substring($string, $_lenS, 1)"/><xsl:choose><xsl:when test="normalize-space($_last) = ''"><xsl:call-template name="ut:trim_end"><xsl:with-param name="string" select="substring($string, 1, $_lenS - 1)"/></xsl:call-template></xsl:when><xsl:otherwise><xsl:value-of select="$string"/></xsl:otherwise></xsl:choose></xsl:when><xsl:otherwise><xsl:choose><xsl:when test="substring($string, $_lenS - $_lenT + 1) = $target"><xsl:call-template name="ut:trim_end"><xsl:with-param name="string" select="substring($string, 1, $_lenS - $_lenT)"/><xsl:with-param name="target" select="$target"/></xsl:call-template></xsl:when><xsl:otherwise><xsl:value-of select="$string"/></xsl:otherwise></xsl:choose></xsl:otherwise></xsl:choose></xsl:template><xsl:template name="ut:trim"><xsl:param name="string"/><xsl:param name="target"/><xsl:variable name="_str"><xsl:call-template name="ut:trim_start"><xsl:with-param name="string" select="$string"/><xsl:with-param name="target" select="$target"/></xsl:call-template></xsl:variable><xsl:call-template name="ut:trim_end"><xsl:with-param name="string" select="$_str"/><xsl:with-param name="target" select="$target"/></xsl:call-template></xsl:template><xsl:template name="ut:validate"><xsl:param name="string"/><xsl:param name="forbidden"/><xsl:param name="default"/><xsl:variable name="_s" select="translate($string, $forbidden, '')"/><xsl:choose><xsl:when test="string-length($_s) = string-length($string)"><xsl:value-of select="$string"/></xsl:when><xsl:otherwise><xsl:value-of select="$default"/></xsl:otherwise></xsl:choose></xsl:template><xsl:template name="do:count_nodes_by_path"><xsl:param name="path"/><xsl:param name="prefix"/><xsl:param name="suffix"/><xsl:param name="data_url"/><xsl:param name="data_gid"/><xsl:variable name="_expath"><xsl:call-template name="do:expand_path"><xsl:with-param name="path" select="$path"/></xsl:call-template></xsl:variable><xsl:call-template name="do:count_nodes_by_expath"><xsl:with-param name="expath" select="$_expath"/><xsl:with-param name="prefix" select="$prefix"/><xsl:with-param name="suffix" select="$suffix"/><xsl:with-param name="data_url" select="$data_url"/><xsl:with-param name="data_gid" select="$data_gid"/></xsl:call-template></xsl:template><xsl:template name="do:count_nodes_by_expath"><xsl:param name="expath"/><xsl:param name="prefix"/><xsl:param name="suffix"/><xsl:param name="data_url"/><xsl:param name="data_gid"/><xsl:choose><xsl:when test="string-length($data_url) = 0"><xsl:choose><xsl:when test="string-length($data_gid) = 0"><xsl:call-template name="do:_count_nodes_by_expath_from_current_node"><xsl:with-param name="expath" select="$expath"/><xsl:with-param name="prefix" select="$prefix"/><xsl:with-param name="suffix" select="$suffix"/></xsl:call-template></xsl:when><xsl:otherwise><xsl:for-each select="//attribute::node()[generate-id() = $data_gid]|//*[generate-id() = $data_gid]"><xsl:call-template name="do:_count_nodes_by_expath_from_current_node"><xsl:with-param name="expath" select="$expath"/><xsl:with-param name="prefix" select="$prefix"/><xsl:with-param name="suffix" select="$suffix"/></xsl:call-template></xsl:for-each></xsl:otherwise></xsl:choose></xsl:when><xsl:otherwise><xsl:for-each select="document($data_url, /)"><xsl:choose><xsl:when test="string-length($data_gid) = 0"><xsl:call-template name="do:_count_nodes_by_expath_from_current_node"><xsl:with-param name="expath" select="$expath"/><xsl:with-param name="prefix" select="$prefix"/><xsl:with-param name="suffix" select="$suffix"/></xsl:call-template></xsl:when><xsl:otherwise><xsl:for-each select="//attribute::node()[generate-id() = $data_gid]|//*[generate-id() = $data_gid]"><xsl:call-template name="do:_count_nodes_by_expath_from_current_node"><xsl:with-param name="expath" select="$expath"/><xsl:with-param name="prefix" select="$prefix"/><xsl:with-param name="suffix" select="$suffix"/></xsl:call-template></xsl:for-each></xsl:otherwise></xsl:choose></xsl:for-each></xsl:otherwise></xsl:choose></xsl:template><xsl:template name="do:_count_nodes_by_expath_from_current_node"><xsl:param name="expath"/><xsl:param name="prefix"/><xsl:param name="suffix"/><xsl:variable name="_flags"><xsl:call-template name="do:get_objects_by_expath"><xsl:with-param name="expath" select="$expath"/><xsl:with-param name="suffix">I</xsl:with-param></xsl:call-template></xsl:variable><xsl:value-of select="$prefix"/><xsl:value-of select="string-length($_flags)"/><xsl:value-of select="$suffix"/></xsl:template><xsl:template name="do:expand_path"><xsl:param name="path"/><xsl:param name="path_sep" select="$do:_path_sep"/><xsl:choose><xsl:when test="substring($path, 1, 1) = '/'"><xsl:value-of select="$path_sep"/><xsl:call-template name="do:_expand_path_rcr"><xsl:with-param name="path" select="substring($path, 2)"/><xsl:with-param name="path_sep" select="$path_sep"/></xsl:call-template></xsl:when><xsl:otherwise><xsl:call-template name="do:_expand_path_rcr"><xsl:with-param name="path" select="$path"/><xsl:with-param name="path_sep" select="$path_sep"/></xsl:call-template></xsl:otherwise></xsl:choose></xsl:template><xsl:template name="do:_expand_path_rcr"><xsl:param name="path"/><xsl:param name="path_sep"/><xsl:choose><xsl:when test="string-length($path) = 0"/><xsl:when test="starts-with($path, '/')"><xsl:variable name="_next" select="substring($path, 2)"/><xsl:choose><xsl:when test="string-length($_next) = 0"/><xsl:otherwise><xsl:call-template name="do:_format_node"><xsl:with-param name="localname">**</xsl:with-param><xsl:with-param name="path_sep" select="$path_sep"/></xsl:call-template><xsl:call-template name="do:_expand_path_rcr"><xsl:with-param name="path" select="$_next"/><xsl:with-param name="path_sep" select="$path_sep"/></xsl:call-template></xsl:otherwise></xsl:choose></xsl:when><xsl:otherwise><xsl:variable name="_first"><xsl:call-template name="do:_get_first_node"><xsl:with-param name="path" select="$path"/><xsl:with-param name="path_sep" select="$path_sep"/></xsl:call-template></xsl:variable><xsl:call-template name="do:_expand_first_node"><xsl:with-param name="name" select="$_first"/><xsl:with-param name="path_sep" select="$path_sep"/></xsl:call-template><xsl:if test="string-length($_first) != 0"><xsl:variable name="_len" select="string-length($_first)"/><xsl:variable name="_next" select="substring($path, $_len + 2)"/><xsl:call-template name="do:_expand_path_rcr"><xsl:with-param name="path" select="$_next"/><xsl:with-param name="path_sep" select="$path_sep"/></xsl:call-template></xsl:if></xsl:otherwise></xsl:choose></xsl:template><xsl:template name="do:_format_node"><xsl:param name="attr_mark"/><xsl:param name="namespace"/><xsl:param name="localname"/><xsl:param name="condition"/><xsl:param name="path_sep"/><xsl:value-of select="$attr_mark"/><xsl:value-of select="$namespace"/><xsl:value-of select="$do:_ns_sep"/><xsl:value-of select="$localname"/><xsl:value-of select="$do:_cond_sep"/><xsl:value-of select="$condition"/><xsl:value-of select="$path_sep"/></xsl:template><xsl:template name="do:_get_first_node"><xsl:param name="path"/><xsl:param name="path_sep"/><xsl:variable name="_str0" select="substring-before($path, '/')"/><xsl:variable name="_len0" select="string-length($_str0)"/><xsl:choose><xsl:when test="$_len0 = 0"><xsl:value-of select="$path"/></xsl:when><xsl:otherwise><xsl:variable name="_str1" select="substring-after($_str0, '[')"/><xsl:variable name="_len1" select="string-length($_str1)"/><xsl:choose><xsl:when test="$_len1 = 0 and substring($_str0, $_len0) != '['"><xsl:value-of select="$_str0"/></xsl:when><xsl:when test="contains($_str1, ']')"><xsl:value-of select="$_str0"/></xsl:when><xsl:otherwise><xsl:variable name="_str2" select="substring($path, $_len0 + 1)"/><xsl:variable name="_str3" select="substring-before($_str2, ']')"/><xsl:variable name="_len3" select="string-length($_str3)"/><xsl:choose><xsl:when test="$_len3 = 0"><xsl:value-of select="$path"/></xsl:when><xsl:otherwise><xsl:variable name="_str4" select="substring($_str2, $_len3 + 1)"/><xsl:variable name="_str5" select="substring-before($_str4, '/')"/><xsl:variable name="_len5" select="string-length($_str5)"/><xsl:choose><xsl:when test="$_len5 = 0"><xsl:value-of select="$path"/></xsl:when><xsl:otherwise><xsl:variable name="_len" select="$_len0 + $_len3 + $_len5"/><xsl:value-of select="substring($path, 1, $_len)"/></xsl:otherwise></xsl:choose></xsl:otherwise></xsl:choose></xsl:otherwise></xsl:choose></xsl:otherwise></xsl:choose></xsl:template><xsl:template name="do:_expand_first_node"><xsl:param name="name"/><xsl:param name="path_sep"/><xsl:variable name="_at"><xsl:if test="starts-with($name, '@')">@</xsl:if></xsl:variable><xsl:variable name="_str0"><xsl:choose><xsl:when test="string-length($_at) = 0"><xsl:value-of select="$name"/></xsl:when><xsl:otherwise><xsl:value-of select="substring($name, 2)"/></xsl:otherwise></xsl:choose></xsl:variable><xsl:variable name="_str1" select="substring-before($_str0, '[')"/><xsl:variable name="_len1" select="string-length($_str1)"/><xsl:variable name="_str2"><xsl:choose><xsl:when test="$_len1 = 0"><xsl:value-of select="$_str0"/></xsl:when><xsl:otherwise><xsl:value-of select="$_str1"/></xsl:otherwise></xsl:choose></xsl:variable><xsl:variable name="_prefix" select="substring-before($_str2, ':')"/><xsl:variable name="_ns"><xsl:call-template name="ut:get_namespace_uri"><xsl:with-param name="prefix" select="$_prefix"/></xsl:call-template></xsl:variable><xsl:variable name="_lname"><xsl:choose><xsl:when test="string-length($_prefix) = 0"><xsl:value-of select="$_str2"/></xsl:when><xsl:otherwise><xsl:value-of select="substring($_str2, string-length($_prefix) + 2)"/></xsl:otherwise></xsl:choose></xsl:variable><xsl:variable name="_cond"><xsl:variable name="_str3" select="substring($_str0, $_len1 + 2)"/><xsl:variable name="_len3" select="string-length($_str3)"/><xsl:choose><xsl:when test="substring($_str3, $_len3) = ']'"><xsl:value-of select="substring($_str3, 1, $_len3 - 1)"/></xsl:when><xsl:otherwise><xsl:value-of select="substring-before($_str3, ']')"/></xsl:otherwise></xsl:choose></xsl:variable><xsl:variable name="_expanded_cond"><xsl:call-template name="do:expand_path_in_condition"><xsl:with-param name="condition" select="$_cond"/></xsl:call-template></xsl:variable><xsl:call-template name="do:_format_node"><xsl:with-param name="attr_mark" select="$_at"/><xsl:with-param name="namespace" select="$_ns"/><xsl:with-param name="localname" select="$_lname"/><xsl:with-param name="condition" select="$_expanded_cond"/><xsl:with-param name="path_sep" select="$path_sep"/></xsl:call-template></xsl:template><xsl:template name="do:expand_path_in_condition"><xsl:param name="condition"/><xsl:variable name="_cond0"><xsl:call-template name="ut:trim"><xsl:with-param name="string" select="$condition"/></xsl:call-template></xsl:variable><xsl:choose><xsl:when test="string-length($_cond0) = 0"/><xsl:otherwise><xsl:variable name="_pos" select="number($_cond0)"/><xsl:choose><xsl:when test="boolean($_pos)"><xsl:value-of select="$_pos"/></xsl:when><xsl:otherwise><xsl:call-template name="do:_expand_path_in_or_condition"><xsl:with-param name="conds" select="$_cond0"/></xsl:call-template></xsl:otherwise></xsl:choose></xsl:otherwise></xsl:choose></xsl:template><xsl:template name="do:_expand_path_in_or_condition"><xsl:param name="conds"/><xsl:choose><xsl:when test="string-length($conds) = 0 or $conds = '|'"/><xsl:otherwise><xsl:variable name="_cond0"><xsl:call-template name="ut:trim_end"><xsl:with-param name="string" select="substring-before($conds, '|')"/></xsl:call-template></xsl:variable><xsl:variable name="_next0"><xsl:call-template name="ut:trim_start"><xsl:with-param name="string" select="substring-after($conds, '|')"/></xsl:call-template></xsl:variable><xsl:choose><xsl:when test="string-length($_cond0) = 0 and string-length($_next0) = 0"><xsl:variable name="_cond1"><xsl:call-template name="do:_expand_path_in_and_condition"><xsl:with-param name="conds" select="$conds"/></xsl:call-template></xsl:variable><xsl:if test="string-length($_cond1) != 0"><xsl:value-of select="$_cond1"/><xsl:value-of select="$do:_cond_or_sep"/></xsl:if></xsl:when><xsl:otherwise><xsl:variable name="_cond1"><xsl:call-template name="do:_expand_path_in_and_condition"><xsl:with-param name="conds" select="$_cond0"/></xsl:call-template></xsl:variable><xsl:if test="string-length($_cond1) != 0"><xsl:value-of select="$_cond1"/><xsl:value-of select="$do:_cond_or_sep"/></xsl:if><xsl:call-template name="do:_expand_path_in_or_condition"><xsl:with-param name="conds" select="$_next0"/></xsl:call-template></xsl:otherwise></xsl:choose></xsl:otherwise></xsl:choose></xsl:template><xsl:template name="do:_expand_path_in_and_condition"><xsl:param name="conds"/><xsl:choose><xsl:when test="string-length($conds) = 0 or $conds = ','"/><xsl:otherwise><xsl:variable name="_cond0"><xsl:call-template name="ut:trim_end"><xsl:with-param name="string" select="substring-before($conds, ',')"/></xsl:call-template></xsl:variable><xsl:variable name="_next0"><xsl:call-template name="ut:trim_start"><xsl:with-param name="string" select="substring-after($conds, ',')"/></xsl:call-template></xsl:variable><xsl:choose><xsl:when test="string-length($_cond0) =0 and string-length($_next0) =0"><xsl:variable name="_cond1"><xsl:call-template name="do:_expand_path_in_single_condition"><xsl:with-param name="expr" select="$conds"/></xsl:call-template></xsl:variable><xsl:if test="string-length($_cond1) != 0"><xsl:value-of select="$_cond1"/><xsl:value-of select="$do:_cond_and_sep"/></xsl:if></xsl:when><xsl:otherwise><xsl:variable name="_cond1"><xsl:call-template name="do:_expand_path_in_single_condition"><xsl:with-param name="expr" select="$_cond0"/></xsl:call-template></xsl:variable><xsl:if test="string-length($_cond1) != 0"><xsl:value-of select="$_cond1"/><xsl:value-of select="$do:_cond_and_sep"/></xsl:if><xsl:call-template name="do:_expand_path_in_and_condition"><xsl:with-param name="conds" select="$_next0"/></xsl:call-template></xsl:otherwise></xsl:choose></xsl:otherwise></xsl:choose></xsl:template><xsl:template name="do:_expand_path_in_single_condition"><xsl:param name="expr"/><xsl:call-template name="do:_expand_path_in_single_condition_by_op"><xsl:with-param name="expr" select="$expr"/><xsl:with-param name="op_mark"><xsl:choose><xsl:when test="contains($expr, '!=')">!=</xsl:when><xsl:when test="contains($expr, '=')">=</xsl:when><xsl:when test="contains($expr, ' eq ')"> eq </xsl:when><xsl:when test="contains($expr, ' ne ')"> ne </xsl:when><xsl:when test="contains($expr, ' gt ')"> gt </xsl:when><xsl:when test="contains($expr, ' ge ')"> ge </xsl:when><xsl:when test="contains($expr, ' lt ')"> lt </xsl:when><xsl:when test="contains($expr, ' le ')"> le </xsl:when></xsl:choose></xsl:with-param><xsl:with-param name="op"><xsl:choose><xsl:when test="contains($expr, '!=')">ne</xsl:when><xsl:when test="contains($expr, '=')">eq</xsl:when><xsl:when test="contains($expr, ' eq ')">eq</xsl:when><xsl:when test="contains($expr, ' ne ')">ne</xsl:when><xsl:when test="contains($expr, ' gt ')">gt</xsl:when><xsl:when test="contains($expr, ' ge ')">ge</xsl:when><xsl:when test="contains($expr, ' lt ')">lt</xsl:when><xsl:when test="contains($expr, ' le ')">le</xsl:when></xsl:choose></xsl:with-param></xsl:call-template></xsl:template><xsl:template name="do:_expand_path_in_single_condition_by_op"><xsl:param name="expr"/><xsl:param name="op_mark"/><xsl:param name="op"/><xsl:variable name="_path"><xsl:call-template name="ut:trim_end"><xsl:with-param name="string" select="substring-before($expr, $op_mark)"/></xsl:call-template></xsl:variable><xsl:call-template name="do:expand_path"><xsl:with-param name="path" select="$_path"/><xsl:with-param name="path_sep" select="$do:_cond_path_sep"/></xsl:call-template><xsl:value-of select="$do:_cond_op_sep"/><xsl:value-of select="$op"/><xsl:value-of select="$do:_cond_op_sep"/><xsl:call-template name="ut:trim_start"><xsl:with-param name="string" select="substring-after($expr, $op_mark)"/></xsl:call-template></xsl:template><xsl:template name="do:first_object_by_path"><xsl:param name="path"/><xsl:param name="what"/><xsl:param name="prefix"/><xsl:param name="suffix"/><xsl:param name="data_url"/><xsl:param name="data_gid"/><xsl:variable name="_expath"><xsl:call-template name="do:expand_path"><xsl:with-param name="path" select="$path"/></xsl:call-template></xsl:variable><xsl:call-template name="do:first_object_by_expath"><xsl:with-param name="expath" select="$_expath"/><xsl:with-param name="what" select="$what"/><xsl:with-param name="prefix" select="$prefix"/><xsl:with-param name="suffix" select="$suffix"/><xsl:with-param name="data_url" select="$data_url"/><xsl:with-param name="data_gid" select="$data_gid"/></xsl:call-template></xsl:template><xsl:template name="do:first_object_by_expath"><xsl:param name="expath"/><xsl:param name="what"/><xsl:param name="prefix"/><xsl:param name="suffix"/><xsl:param name="data_url"/><xsl:param name="data_gid"/><xsl:choose><xsl:when test="string-length($data_url) = 0"><xsl:choose><xsl:when test="string-length($data_gid) = 0"><xsl:call-template name="do:_first_object_by_expath_from_current_node"><xsl:with-param name="expath" select="$expath"/><xsl:with-param name="what" select="$what"/><xsl:with-param name="prefix" select="$prefix"/><xsl:with-param name="suffix" select="$suffix"/></xsl:call-template></xsl:when><xsl:otherwise><xsl:for-each select="//attribute::node()[generate-id() = $data_gid]|//*[generate-id() = $data_gid]"><xsl:call-template name="do:_first_object_by_expath_from_current_node"><xsl:with-param name="expath" select="$expath"/><xsl:with-param name="what" select="$what"/><xsl:with-param name="prefix" select="$prefix"/><xsl:with-param name="suffix" select="$suffix"/></xsl:call-template></xsl:for-each></xsl:otherwise></xsl:choose></xsl:when><xsl:otherwise><xsl:for-each select="document($data_url, /)"><xsl:choose><xsl:when test="string-length($data_gid) = 0"><xsl:call-template name="do:_first_object_by_expath_from_current_node"><xsl:with-param name="expath" select="$expath"/><xsl:with-param name="what" select="$what"/><xsl:with-param name="prefix" select="$prefix"/><xsl:with-param name="suffix" select="$suffix"/></xsl:call-template></xsl:when><xsl:otherwise><xsl:for-each select="//attribute::node()[generate-id() = $data_gid]|//*[generate-id() = $data_gid]"><xsl:call-template name="do:_first_object_by_expath_from_current_node"><xsl:with-param name="expath" select="$expath"/><xsl:with-param name="what" select="$what"/><xsl:with-param name="prefix" select="$prefix"/><xsl:with-param name="suffix" select="$suffix"/></xsl:call-template></xsl:for-each></xsl:otherwise></xsl:choose></xsl:for-each></xsl:otherwise></xsl:choose></xsl:template><xsl:template name="do:_first_object_by_expath_from_current_node"><xsl:param name="expath"/><xsl:param name="what"/><xsl:param name="prefix"/><xsl:param name="suffix"/><xsl:variable name="_gids"><xsl:call-template name="do:get_objects_by_expath"><xsl:with-param name="expath" select="$expath"/><xsl:with-param name="what">id</xsl:with-param><xsl:with-param name="suffix" select="$do:_object_sep"/></xsl:call-template></xsl:variable><xsl:variable name="_gid" select="normalize-space(substring-before($_gids, $do:_object_sep))"/><xsl:for-each select="//attribute::node()[generate-id() = $_gid]"><xsl:call-template name="do:get_current_attribute"><xsl:with-param name="what" select="$what"/><xsl:with-param name="prefix" select="$prefix"/><xsl:with-param name="suffix" select="$suffix"/></xsl:call-template></xsl:for-each><xsl:for-each select="//*[generate-id() = $_gid]"><xsl:call-template name="do:get_current_value"><xsl:with-param name="what" select="$what"/><xsl:with-param name="prefix" select="$prefix"/><xsl:with-param name="suffix" select="$suffix"/></xsl:call-template></xsl:for-each></xsl:template><xsl:template name="do:for_by_path"><xsl:param name="path"/><xsl:param name="data_url"/><xsl:param name="data_gid"/><xsl:param name="allow"/><xsl:param name="allow_text_node" select="$ut:true"/><xsl:param name="deny"/><xsl:param name="arg0"/><xsl:param name="arg1"/><xsl:param name="arg2"/><xsl:variable name="_expath"><xsl:call-template name="do:expand_path"><xsl:with-param name="path" select="$path"/><xsl:with-param name="what">id</xsl:with-param></xsl:call-template></xsl:variable><xsl:call-template name="do:for_by_expath"><xsl:with-param name="expath" select="$_expath"/><xsl:with-param name="data_url" select="$data_url"/><xsl:with-param name="data_gid" select="$data_gid"/><xsl:with-param name="allow" select="$allow"/><xsl:with-param name="allow_text_node" select="$allow_text_node"/><xsl:with-param name="deny" select="$deny"/><xsl:with-param name="arg0" select="$arg0"/><xsl:with-param name="arg1" select="$arg1"/><xsl:with-param name="arg2" select="$arg2"/></xsl:call-template></xsl:template><xsl:template name="do:for_by_expath"><xsl:param name="expath"/><xsl:param name="data_url"/><xsl:param name="data_gid"/><xsl:param name="allow"/><xsl:param name="allow_text_node" select="$ut:true"/><xsl:param name="deny"/><xsl:param name="arg0"/><xsl:param name="arg1"/><xsl:param name="arg2"/><xsl:variable name="_gids"><xsl:choose><xsl:when test="string-length($data_url) = 0"><xsl:choose><xsl:when test="string-length($data_gid) = 0"><xsl:call-template name="do:get_objects_by_expath"><xsl:with-param name="expath" select="$expath"/><xsl:with-param name="what">id</xsl:with-param><xsl:with-param name="suffix" select="$do:_object_sep"/></xsl:call-template></xsl:when><xsl:otherwise><xsl:for-each select="//attribute::node()[generate-id() = $data_gid]"><xsl:call-template name="do:get_objects_by_expath"><xsl:with-param name="expath" select="$expath"/><xsl:with-param name="what">id</xsl:with-param><xsl:with-param name="suffix" select="$do:_object_sep"/></xsl:call-template></xsl:for-each><xsl:for-each select="//*[generate-id() = $data_gid]"><xsl:call-template name="do:get_objects_by_expath"><xsl:with-param name="expath" select="$expath"/><xsl:with-param name="what">id</xsl:with-param><xsl:with-param name="suffix" select="$do:_object_sep"/></xsl:call-template></xsl:for-each></xsl:otherwise></xsl:choose></xsl:when><xsl:otherwise><xsl:for-each select="document($data_url, /)"><xsl:choose><xsl:when test="string-length($data_gid) = 0"><xsl:call-template name="do:get_objects_by_expath"><xsl:with-param name="expath" select="$expath"/><xsl:with-param name="what">id</xsl:with-param><xsl:with-param name="suffix" select="$do:_object_sep"/></xsl:call-template></xsl:when><xsl:otherwise><xsl:for-each select="//attribute::node()[generate-id() = $data_gid]"><xsl:call-template name="do:get_objects_by_expath"><xsl:with-param name="expath" select="$expath"/><xsl:with-param name="what">id</xsl:with-param><xsl:with-param name="suffix" select="$do:_object_sep"/></xsl:call-template></xsl:for-each><xsl:for-each select="//*[generate-id() = $data_gid]"><xsl:call-template name="do:get_objects_by_expath"><xsl:with-param name="expath" select="$expath"/><xsl:with-param name="what">id</xsl:with-param><xsl:with-param name="suffix" select="$do:_object_sep"/></xsl:call-template></xsl:for-each></xsl:otherwise></xsl:choose></xsl:for-each></xsl:otherwise></xsl:choose></xsl:variable><xsl:call-template name="do:_for_by_gids_rcr"><xsl:with-param name="gids" select="$_gids"/><xsl:with-param name="index">1</xsl:with-param><xsl:with-param name="allow" select="$allow"/><xsl:with-param name="allow_text_node" select="$allow_text_node"/><xsl:with-param name="deny" select="$deny"/><xsl:with-param name="arg0" select="$arg0"/><xsl:with-param name="arg1" select="$arg1"/><xsl:with-param name="arg2" select="$arg2"/><xsl:with-param name="data_url" select="$data_url"/></xsl:call-template></xsl:template><xsl:template name="do:_for_by_gids_rcr"><xsl:param name="gids"/><xsl:param name="index"/><xsl:param name="allow"/><xsl:param name="allow_text_node"/><xsl:param name="deny"/><xsl:param name="arg0"/><xsl:param name="arg1"/><xsl:param name="arg2"/><xsl:param name="data_url"/><xsl:variable name="_gid" select="substring-before($gids, $do:_object_sep)"/><xsl:variable name="_next" select="substring-after($gids, $do:_object_sep)"/><xsl:if test="string-length($_gid) &gt; 0"><xsl:call-template name="do:_apply_each_node"><xsl:with-param name="data_url" select="$data_url"/><xsl:with-param name="data_gid" select="$_gid"/><xsl:with-param name="data_index" select="$index"/><xsl:with-param name="allow" select="$allow"/><xsl:with-param name="allow_text_node" select="$allow_text_node"/><xsl:with-param name="deny" select="$deny"/><xsl:with-param name="arg0" select="$arg0"/><xsl:with-param name="arg1" select="$arg1"/><xsl:with-param name="arg2" select="$arg2"/></xsl:call-template></xsl:if><xsl:if test="string-length($_next) &gt; 0"><xsl:call-template name="do:_for_by_gids_rcr"><xsl:with-param name="gids" select="$_next"/><xsl:with-param name="index" select="$index + 1"/><xsl:with-param name="allow" select="$allow"/><xsl:with-param name="allow_text_node" select="$allow_text_node"/><xsl:with-param name="deny" select="$deny"/><xsl:with-param name="arg0" select="$arg0"/><xsl:with-param name="arg1" select="$arg1"/><xsl:with-param name="arg2" select="$arg2"/><xsl:with-param name="data_url" select="$data_url"/></xsl:call-template></xsl:if></xsl:template><xsl:template name="do:_apply_each_node"><xsl:param name="data_url"/><xsl:param name="data_gid"/><xsl:param name="data_index"/><xsl:param name="allow"/><xsl:param name="allow_text_node"/><xsl:param name="deny"/><xsl:param name="arg0"/><xsl:param name="arg1"/><xsl:param name="arg2"/><xsl:choose><xsl:when test="string-length($allow) = 0"><xsl:choose><xsl:when test="$allow_text_node = $ut:true"><xsl:apply-templates select="text()|*[not(contains($deny, concat('|', name(), '|')))]"><xsl:with-param name="data_url" select="$data_url"/><xsl:with-param name="data_gid" select="$data_gid"/><xsl:with-param name="data_index" select="$data_index"/><xsl:with-param name="allow" select="$allow"/><xsl:with-param name="allow_text_node" select="$allow_text_node"/><xsl:with-param name="deny" select="$deny"/><xsl:with-param name="arg0" select="$arg0"/><xsl:with-param name="arg1" select="$arg1"/><xsl:with-param name="arg2" select="$arg2"/></xsl:apply-templates></xsl:when><xsl:otherwise><xsl:apply-templates select="*[not(contains($deny, concat('|', name(), '|')))]"><xsl:with-param name="data_url" select="$data_url"/><xsl:with-param name="data_gid" select="$data_gid"/><xsl:with-param name="data_index" select="$data_index"/><xsl:with-param name="allow" select="$allow"/><xsl:with-param name="allow_text_node" select="$allow_text_node"/><xsl:with-param name="deny" select="$deny"/><xsl:with-param name="arg0" select="$arg0"/><xsl:with-param name="arg1" select="$arg1"/><xsl:with-param name="arg2" select="$arg2"/></xsl:apply-templates></xsl:otherwise></xsl:choose></xsl:when><xsl:otherwise><xsl:choose><xsl:when test="$allow_text_node = $ut:true"><xsl:apply-templates select="text()|*[contains($allow, concat('|', name(), '|')) and not(contains($deny, concat('|', name(), '|')))]"><xsl:with-param name="data_url" select="$data_url"/><xsl:with-param name="data_gid" select="$data_gid"/><xsl:with-param name="data_index" select="$data_index"/><xsl:with-param name="allow" select="$allow"/><xsl:with-param name="allow_text_node" select="$allow_text_node"/><xsl:with-param name="deny" select="$deny"/><xsl:with-param name="arg0" select="$arg0"/><xsl:with-param name="arg1" select="$arg1"/><xsl:with-param name="arg2" select="$arg2"/></xsl:apply-templates></xsl:when><xsl:otherwise><xsl:apply-templates select="*[contains($allow, concat('|', name(), '|')) and not(contains($deny, concat('|', name(), '|')))]"><xsl:with-param name="data_url" select="$data_url"/><xsl:with-param name="data_gid" select="$data_gid"/><xsl:with-param name="data_index" select="$data_index"/><xsl:with-param name="allow" select="$allow"/><xsl:with-param name="allow_text_node" select="$allow_text_node"/><xsl:with-param name="deny" select="$deny"/><xsl:with-param name="arg0" select="$arg0"/><xsl:with-param name="arg1" select="$arg1"/><xsl:with-param name="arg2" select="$arg2"/></xsl:apply-templates></xsl:otherwise></xsl:choose></xsl:otherwise></xsl:choose></xsl:template><xsl:template name="do:for_times"><xsl:param name="data_url"/><xsl:param name="data_gid"/><xsl:param name="times"/><xsl:param name="allow"/><xsl:param name="allow_text_node" select="$ut:true"/><xsl:param name="deny"/><xsl:param name="arg0"/><xsl:param name="arg1"/><xsl:param name="arg2"/><xsl:call-template name="do:_for_times_rcr"><xsl:with-param name="times" select="$times"/><xsl:with-param name="index">1</xsl:with-param><xsl:with-param name="allow" select="$allow"/><xsl:with-param name="allow_text_node" select="$allow_text_node"/><xsl:with-param name="deny" select="$deny"/><xsl:with-param name="arg0" select="$arg0"/><xsl:with-param name="arg1" select="$arg1"/><xsl:with-param name="arg2" select="$arg2"/><xsl:with-param name="data_url" select="$data_url"/><xsl:with-param name="data_gid" select="$data_gid"/></xsl:call-template></xsl:template><xsl:template name="do:_for_times_rcr"><xsl:param name="times"/><xsl:param name="index"/><xsl:param name="allow"/><xsl:param name="allow_text_node"/><xsl:param name="deny"/><xsl:param name="arg0"/><xsl:param name="arg1"/><xsl:param name="arg2"/><xsl:param name="data_url"/><xsl:param name="data_gid"/><xsl:if test="$index &lt;= $times"><xsl:call-template name="do:_apply_each_node"><xsl:with-param name="data_url" select="$data_url"/><xsl:with-param name="data_gid" select="$data_gid"/><xsl:with-param name="data_index" select="$index"/><xsl:with-param name="allow" select="$allow"/><xsl:with-param name="allow_text_node" select="$allow_text_node"/><xsl:with-param name="deny" select="$deny"/><xsl:with-param name="arg0" select="$arg0"/><xsl:with-param name="arg1" select="$arg1"/><xsl:with-param name="arg2" select="$arg2"/></xsl:call-template><xsl:call-template name="do:_for_times_rcr"><xsl:with-param name="times" select="$times"/><xsl:with-param name="index" select="$index + 1"/><xsl:with-param name="allow" select="$allow"/><xsl:with-param name="allow_text_node" select="$allow_text_node"/><xsl:with-param name="deny" select="$deny"/><xsl:with-param name="arg0" select="$arg0"/><xsl:with-param name="arg1" select="$arg1"/><xsl:with-param name="arg2" select="$arg2"/><xsl:with-param name="data_url" select="$data_url"/><xsl:with-param name="data_gid" select="$data_gid"/></xsl:call-template></xsl:if></xsl:template><xsl:template name="do:get_objects_by_path"><xsl:param name="path"/><xsl:param name="what"/><xsl:param name="prefix"/><xsl:param name="suffix"/><xsl:param name="data_url"/><xsl:param name="data_gid"/><xsl:variable name="_expath"><xsl:call-template name="do:expand_path"><xsl:with-param name="path" select="$path"/></xsl:call-template></xsl:variable><xsl:call-template name="do:get_objects_by_expath"><xsl:with-param name="expath" select="$_expath"/><xsl:with-param name="what" select="$what"/><xsl:with-param name="prefix" select="$prefix"/><xsl:with-param name="suffix" select="$suffix"/><xsl:with-param name="data_url" select="$data_url"/><xsl:with-param name="data_gid" select="$data_gid"/></xsl:call-template></xsl:template><xsl:template name="do:get_objects_by_expath"><xsl:param name="expath"/><xsl:param name="what"/><xsl:param name="prefix"/><xsl:param name="suffix"/><xsl:param name="data_url"/><xsl:param name="data_gid"/><xsl:choose><xsl:when test="string-length($data_url) = 0"><xsl:choose><xsl:when test="string-length($data_gid) = 0"><xsl:call-template name="do:_get_objects_by_expath_from_current_node"><xsl:with-param name="expath" select="$expath"/><xsl:with-param name="what" select="$what"/><xsl:with-param name="prefix" select="$prefix"/><xsl:with-param name="suffix" select="$suffix"/></xsl:call-template></xsl:when><xsl:otherwise><xsl:for-each select="//attribute::node()[generate-id() = $data_gid]"><xsl:call-template name="do:_get_objects_by_expath_from_current_node"><xsl:with-param name="expath" select="$expath"/><xsl:with-param name="what" select="$what"/><xsl:with-param name="prefix" select="$prefix"/><xsl:with-param name="suffix" select="$suffix"/></xsl:call-template></xsl:for-each><xsl:for-each select="//*[generate-id() = $data_gid]"><xsl:call-template name="do:_get_objects_by_expath_from_current_node"><xsl:with-param name="expath" select="$expath"/><xsl:with-param name="what" select="$what"/><xsl:with-param name="prefix" select="$prefix"/><xsl:with-param name="suffix" select="$suffix"/></xsl:call-template></xsl:for-each></xsl:otherwise></xsl:choose></xsl:when><xsl:otherwise><xsl:for-each select="document($data_url, /)"><xsl:choose><xsl:when test="string-length($data_gid) = 0"><xsl:call-template name="do:_get_objects_by_expath_from_current_node"><xsl:with-param name="expath" select="$expath"/><xsl:with-param name="what" select="$what"/><xsl:with-param name="prefix" select="$prefix"/><xsl:with-param name="suffix" select="$suffix"/></xsl:call-template></xsl:when><xsl:otherwise><xsl:for-each select="//attribute::node()[generate-id() = $data_gid]"><xsl:call-template name="do:_get_objects_by_expath_from_current_node"><xsl:with-param name="expath" select="$expath"/><xsl:with-param name="what" select="$what"/><xsl:with-param name="prefix" select="$prefix"/><xsl:with-param name="suffix" select="$suffix"/></xsl:call-template></xsl:for-each><xsl:for-each select="//*[generate-id() = $data_gid]"><xsl:call-template name="do:_get_objects_by_expath_from_current_node"><xsl:with-param name="expath" select="$expath"/><xsl:with-param name="what" select="$what"/><xsl:with-param name="prefix" select="$prefix"/><xsl:with-param name="suffix" select="$suffix"/></xsl:call-template></xsl:for-each></xsl:otherwise></xsl:choose></xsl:for-each></xsl:otherwise></xsl:choose></xsl:template><xsl:template name="do:_get_objects_by_expath_from_current_node"><xsl:param name="expath"/><xsl:param name="what"/><xsl:param name="prefix"/><xsl:param name="suffix"/><xsl:param name="data_url"/><xsl:param name="data_gid"/><xsl:param name="path_sep" select="$do:_path_sep"/><xsl:choose><xsl:when test="starts-with($expath, $path_sep)"><xsl:for-each select="/"><xsl:variable name="_next" select="substring-after($expath, $path_sep)"/><xsl:call-template name="do:_get_objects_by_expath_rcr"><xsl:with-param name="expath" select="$_next"/><xsl:with-param name="what" select="$what"/><xsl:with-param name="prefix" select="$prefix"/><xsl:with-param name="suffix" select="$suffix"/><xsl:with-param name="path_sep" select="$path_sep"/></xsl:call-template></xsl:for-each></xsl:when><xsl:otherwise><xsl:call-template name="do:_get_objects_by_expath_rcr"><xsl:with-param name="expath" select="$expath"/><xsl:with-param name="what" select="$what"/><xsl:with-param name="prefix" select="$prefix"/><xsl:with-param name="suffix" select="$suffix"/><xsl:with-param name="path_sep" select="$path_sep"/></xsl:call-template></xsl:otherwise></xsl:choose></xsl:template><xsl:template name="do:_get_objects_by_expath_rcr"><xsl:param name="expath"/><xsl:param name="what"/><xsl:param name="prefix"/><xsl:param name="suffix"/><xsl:param name="path_sep"/><xsl:choose><xsl:when test="$expath = ''"><xsl:call-template name="do:get_current_value"><xsl:with-param name="what" select="$what"/><xsl:with-param name="prefix" select="$prefix"/><xsl:with-param name="suffix" select="$suffix"/></xsl:call-template></xsl:when><xsl:otherwise><xsl:variable name="_nd0" select="substring-before($expath, $path_sep)"/><xsl:variable name="_next" select="substring-after($expath, $path_sep)"/><xsl:variable name="_at"><xsl:if test="starts-with($_nd0, '@')"><xsl:value-of select="$ut:true"/></xsl:if></xsl:variable><xsl:variable name="_nd1"><xsl:choose><xsl:when test="$_at = $ut:true"><xsl:value-of select="substring($_nd0, 2)"/></xsl:when><xsl:otherwise><xsl:value-of select="$_nd0"/></xsl:otherwise></xsl:choose></xsl:variable><xsl:variable name="_ns" select="substring-before($_nd1, $do:_ns_sep)"/><xsl:variable name="_nd2" select="substring-after($_nd1, $do:_ns_sep)"/><xsl:variable name="_lnm" select="substring-before($_nd2, $do:_cond_sep)"/><xsl:variable name="_cnd" select="substring-after($_nd2, $do:_cond_sep)"/><xsl:call-template name="do:_resolve_namespace_and_localname"><xsl:with-param name="is_attr" select="$_at"/><xsl:with-param name="namespace" select="$_ns"/><xsl:with-param name="localname" select="$_lnm"/><xsl:with-param name="condition" select="$_cnd"/><xsl:with-param name="next_expath" select="$_next"/><xsl:with-param name="what" select="$what"/><xsl:with-param name="prefix" select="$prefix"/><xsl:with-param name="suffix" select="$suffix"/><xsl:with-param name="path_sep" select="$path_sep"/></xsl:call-template></xsl:otherwise></xsl:choose></xsl:template><xsl:template name="do:_resolve_namespace_and_localname"><xsl:param name="is_attr"/><xsl:param name="namespace"/><xsl:param name="localname"/><xsl:param name="condition"/><xsl:param name="next_expath"/><xsl:param name="what"/><xsl:param name="prefix"/><xsl:param name="suffix"/><xsl:param name="path_sep"/><xsl:choose><xsl:when test="$is_attr = $ut:true"><xsl:if test="string-length($next_expath) = 0"><xsl:for-each select="attribute::node()[$namespace = namespace-uri() and $localname = local-name()]"><xsl:call-template name="do:_get_conditional_attribute"><xsl:with-param name="condition" select="$condition"/><xsl:with-param name="next_expath" select="$next_expath"/><xsl:with-param name="what" select="$what"/><xsl:with-param name="prefix" select="$prefix"/><xsl:with-param name="suffix" select="$suffix"/></xsl:call-template></xsl:for-each></xsl:if></xsl:when><xsl:when test="$localname = '*'"><xsl:choose><xsl:when test="string-length($namespace) = 0"><xsl:for-each select="*"><xsl:call-template name="do:_get_conditional_object"><xsl:with-param name="condition" select="$condition"/><xsl:with-param name="next_expath" select="$next_expath"/><xsl:with-param name="what" select="$what"/><xsl:with-param name="prefix" select="$prefix"/><xsl:with-param name="suffix" select="$suffix"/><xsl:with-param name="path_sep" select="$path_sep"/></xsl:call-template></xsl:for-each></xsl:when><xsl:otherwise><xsl:for-each select="*[namespace-uri() = $namespace]"><xsl:call-template name="do:_get_conditional_object"><xsl:with-param name="condition" select="$condition"/><xsl:with-param name="next_expath" select="$next_expath"/><xsl:with-param name="what" select="$what"/><xsl:with-param name="prefix" select="$prefix"/><xsl:with-param name="suffix" select="$suffix"/><xsl:with-param name="path_sep" select="$path_sep"/></xsl:call-template></xsl:for-each></xsl:otherwise></xsl:choose></xsl:when><xsl:when test="$localname = '**'"><xsl:choose><xsl:when test="string-length($namespace) = 0"><xsl:for-each select="descendant-or-self::node()"><xsl:call-template name="do:_get_conditional_object"><xsl:with-param name="condition" select="$condition"/><xsl:with-param name="next_expath" select="$next_expath"/><xsl:with-param name="what" select="$what"/><xsl:with-param name="prefix" select="$prefix"/><xsl:with-param name="suffix" select="$suffix"/><xsl:with-param name="path_sep" select="$path_sep"/></xsl:call-template></xsl:for-each></xsl:when><xsl:otherwise><xsl:for-each select="descendant-or-self::node()[namespace-uri() = $namespace]"><xsl:call-template name="do:_get_conditional_object"><xsl:with-param name="condition" select="$condition"/><xsl:with-param name="next_expath" select="$next_expath"/><xsl:with-param name="what" select="$what"/><xsl:with-param name="prefix" select="$prefix"/><xsl:with-param name="suffix" select="$suffix"/><xsl:with-param name="path_sep" select="$path_sep"/></xsl:call-template></xsl:for-each></xsl:otherwise></xsl:choose></xsl:when><xsl:when test="$localname = '.'"><xsl:call-template name="do:_get_conditional_object"><xsl:with-param name="condition" select="$condition"/><xsl:with-param name="next_expath" select="$next_expath"/><xsl:with-param name="what" select="$what"/><xsl:with-param name="prefix" select="$prefix"/><xsl:with-param name="suffix" select="$suffix"/><xsl:with-param name="path_sep" select="$path_sep"/></xsl:call-template></xsl:when><xsl:when test="$localname = '..'"><xsl:choose><xsl:when test="string-length($namespace) = 0"><xsl:for-each select="parent::*"><xsl:call-template name="do:_get_conditional_object"><xsl:with-param name="condition" select="$condition"/><xsl:with-param name="next_expath" select="$next_expath"/><xsl:with-param name="what" select="$what"/><xsl:with-param name="prefix" select="$prefix"/><xsl:with-param name="suffix" select="$suffix"/><xsl:with-param name="path_sep" select="$path_sep"/></xsl:call-template></xsl:for-each></xsl:when><xsl:otherwise><xsl:for-each select="parent::*[namespace-uri() = $namespace]"><xsl:call-template name="do:_get_conditional_object"><xsl:with-param name="condition" select="$condition"/><xsl:with-param name="next_expath" select="$next_expath"/><xsl:with-param name="what" select="$what"/><xsl:with-param name="prefix" select="$prefix"/><xsl:with-param name="suffix" select="$suffix"/><xsl:with-param name="path_sep" select="$path_sep"/></xsl:call-template></xsl:for-each></xsl:otherwise></xsl:choose></xsl:when><xsl:otherwise><xsl:for-each select="*[namespace-uri() = $namespace and local-name() = $localname]"><xsl:call-template name="do:_get_conditional_object"><xsl:with-param name="condition" select="$condition"/><xsl:with-param name="next_expath" select="$next_expath"/><xsl:with-param name="what" select="$what"/><xsl:with-param name="prefix" select="$prefix"/><xsl:with-param name="suffix" select="$suffix"/><xsl:with-param name="path_sep" select="$path_sep"/></xsl:call-template></xsl:for-each></xsl:otherwise></xsl:choose></xsl:template><xsl:template name="do:get_current_value"><xsl:param name="what"/><xsl:param name="prefix"/><xsl:param name="suffix"/><xsl:value-of select="$prefix"/><xsl:choose><xsl:when test="$what = 'content'"><xsl:value-of select="normalize-space(.)"/></xsl:when><xsl:when test="$what = 'text'"><xsl:value-of select="normalize-space(text())"/></xsl:when><xsl:when test="$what = 'number'"><xsl:value-of select="number(text())"/></xsl:when><xsl:when test="$what = 'name'"><xsl:value-of select="local-name()"/></xsl:when><xsl:when test="$what = 'id'"><xsl:value-of select="generate-id()"/></xsl:when><xsl:when test="$what = 'preceding-comment'"><xsl:call-template name="do:_get_preceding_comment"/></xsl:when><xsl:when test="$what = 'following-comment'"><xsl:call-template name="do:_get_following_comment"/></xsl:when></xsl:choose><xsl:value-of select="$suffix"/></xsl:template><xsl:template name="do:_get_preceding_comment"><xsl:variable name="_nid1" select="generate-id(preceding-sibling::node()[1])"/><xsl:variable name="_cid1" select="generate-id(preceding-sibling::comment()[1])"/><xsl:choose><xsl:when test="$_nid1 = $_cid1"><xsl:value-of select="preceding-sibling::comment()[1]"/></xsl:when><xsl:otherwise><xsl:variable name="_tid1" select="generate-id(preceding-sibling::text()[1])"/><xsl:if test="$_nid1 = $_tid1"><xsl:if test="string-length(normalize-space(preceding-sibling::text()[1])) = 0"><xsl:variable name="_nid2" select="generate-id(preceding-sibling::node()[2])"/><xsl:if test="$_nid2 = $_cid1"><xsl:value-of select="preceding-sibling::comment()[1]"/></xsl:if></xsl:if></xsl:if></xsl:otherwise></xsl:choose></xsl:template><xsl:template name="do:_get_following_comment"><xsl:variable name="_nid1" select="generate-id(following-sibling::node()[1])"/><xsl:variable name="_cid1" select="generate-id(following-sibling::comment()[1])"/><xsl:choose><xsl:when test="$_nid1 = $_cid1"><xsl:value-of select="following-sibling::comment()[1]"/></xsl:when><xsl:otherwise><xsl:variable name="_tid1" select="generate-id(following-sibling::text()[1])"/><xsl:if test="$_nid1 = $_tid1"><xsl:if test="string-length(normalize-space(following-sibling::text()[1])) = 0"><xsl:variable name="_nid2" select="generate-id(following-sibling::node()[2])"/><xsl:if test="$_nid2 = $_cid1"><xsl:value-of select="following-sibling::comment()[1]"/></xsl:if></xsl:if></xsl:if></xsl:otherwise></xsl:choose></xsl:template><xsl:template name="do:get_current_attribute"><xsl:param name="what"/><xsl:param name="prefix"/><xsl:param name="suffix"/><xsl:value-of select="$prefix"/><xsl:choose><xsl:when test="$what = 'content'"><xsl:value-of select="."/></xsl:when><xsl:when test="$what = 'text'"><xsl:value-of select="."/></xsl:when><xsl:when test="$what = 'number'"><xsl:value-of select="number()"/></xsl:when><xsl:when test="$what = 'name'"><xsl:value-of select="local-name()"/></xsl:when><xsl:when test="$what = 'id'"><xsl:value-of select="generate-id()"/></xsl:when></xsl:choose><xsl:value-of select="$suffix"/></xsl:template><xsl:template name="do:_get_conditional_attribute"><xsl:param name="condition"/><xsl:param name="next_expath"/><xsl:param name="what"/><xsl:param name="prefix"/><xsl:param name="suffix"/><xsl:variable name="_matched"><xsl:call-template name="do:match_condition_by_expath"><xsl:with-param name="condition" select="$condition"/></xsl:call-template></xsl:variable><xsl:if test="$_matched = $ut:true and string-length($next_expath) = 0"><xsl:call-template name="do:get_current_attribute"><xsl:with-param name="what" select="$what"/><xsl:with-param name="prefix" select="$prefix"/><xsl:with-param name="suffix" select="$suffix"/></xsl:call-template></xsl:if></xsl:template><xsl:template name="do:_get_conditional_object"><xsl:param name="condition"/><xsl:param name="next_expath"/><xsl:param name="what"/><xsl:param name="prefix"/><xsl:param name="suffix"/><xsl:param name="path_sep"/><xsl:variable name="_matched"><xsl:call-template name="do:match_condition_by_expath"><xsl:with-param name="condition" select="$condition"/></xsl:call-template></xsl:variable><xsl:if test="$_matched = $ut:true"><xsl:call-template name="do:_get_objects_by_expath_rcr"><xsl:with-param name="expath" select="$next_expath"/><xsl:with-param name="what" select="$what"/><xsl:with-param name="prefix" select="$prefix"/><xsl:with-param name="suffix" select="$suffix"/><xsl:with-param name="path_sep" select="$path_sep"/></xsl:call-template></xsl:if></xsl:template><xsl:template name="do:match_condition_by_expath"><xsl:param name="condition"/><xsl:variable name="_cond0"><xsl:call-template name="ut:trim"><xsl:with-param name="string" select="$condition"/></xsl:call-template></xsl:variable><xsl:choose><xsl:when test="string-length($_cond0) = 0"><xsl:value-of select="$ut:true"/></xsl:when><xsl:otherwise><xsl:variable name="_pos" select="number($_cond0)"/><xsl:choose><xsl:when test="boolean($_pos)"><xsl:if test="$_pos = position()"><xsl:value-of select="$ut:true"/></xsl:if></xsl:when><xsl:otherwise><xsl:call-template name="do:_match_conditions_or"><xsl:with-param name="conds" select="$_cond0"/></xsl:call-template></xsl:otherwise></xsl:choose></xsl:otherwise></xsl:choose></xsl:template><xsl:template name="do:_match_conditions_or"><xsl:param name="conds"/><xsl:choose><xsl:when test="string-length($conds) = 0"/><xsl:otherwise><xsl:variable name="_cond" select="substring-before($conds, $do:_cond_or_sep)"/><xsl:variable name="_matched"><xsl:call-template name="do:_match_conditions_and"><xsl:with-param name="conds" select="$_cond"/></xsl:call-template></xsl:variable><xsl:choose><xsl:when test="$_matched = $ut:true"><xsl:value-of select="$ut:true"/></xsl:when><xsl:otherwise><xsl:variable name="_next" select="substring-after($conds, $do:_cond_or_sep)"/><xsl:call-template name="do:_match_conditions_or"><xsl:with-param name="conds" select="$_next"/></xsl:call-template></xsl:otherwise></xsl:choose></xsl:otherwise></xsl:choose></xsl:template><xsl:template name="do:_match_conditions_and"><xsl:param name="conds"/><xsl:choose><xsl:when test="string-length($conds) = 0"/><xsl:otherwise><xsl:variable name="_cond" select="substring-before($conds, $do:_cond_and_sep)"/><xsl:variable name="_matched"><xsl:call-template name="do:_match_single_condition"><xsl:with-param name="cond" select="$_cond"/></xsl:call-template></xsl:variable><xsl:if test="$_matched = $ut:true"><xsl:variable name="_next" select="substring-after($conds, $do:_cond_and_sep)"/><xsl:choose><xsl:when test="string-length($_next) = 0"><xsl:value-of select="$ut:true"/></xsl:when><xsl:otherwise><xsl:call-template name="do:_match_conditions_and"><xsl:with-param name="conds" select="$_next"/></xsl:call-template></xsl:otherwise></xsl:choose></xsl:if></xsl:otherwise></xsl:choose></xsl:template><xsl:template name="do:_match_single_condition"><xsl:param name="cond"/><xsl:variable name="_after" select="substring-after($cond, $do:_cond_op_sep)"/><xsl:variable name="_op" select="substring-before($_after, $do:_cond_op_sep)"/><xsl:variable name="_right"><xsl:variable name="_r0" select="substring-after($_after, $do:_cond_op_sep)"/><xsl:call-template name="ut:trim_start"><xsl:with-param name="string" select="$_r0"/></xsl:call-template></xsl:variable><xsl:variable name="_quote"><xsl:if test="string(number($_right)) = 'NaN'"><xsl:value-of select="$ut:apos"/></xsl:if></xsl:variable><xsl:variable name="_left"><xsl:variable name="_e0" select="substring-before($cond, $do:_cond_op_sep)"/><xsl:variable name="_e1"><xsl:call-template name="ut:trim_end"><xsl:with-param name="string" select="$_e0"/></xsl:call-template></xsl:variable><xsl:variable name="_e2"><xsl:call-template name="do:_get_objects_by_expath_from_current_node"><xsl:with-param name="expath" select="$_e1"/><xsl:with-param name="what">content</xsl:with-param><xsl:with-param name="prefix" select="$_quote"/><xsl:with-param name="suffix" select="concat($_quote, $do:_object_sep)"/><xsl:with-param name="path_sep" select="$do:_cond_path_sep"/></xsl:call-template></xsl:variable><xsl:variable name="_e3" select="substring-before($_e2, $do:_object_sep)"/><xsl:call-template name="ut:trim"><xsl:with-param name="string" select="$_e3"/></xsl:call-template></xsl:variable><xsl:call-template name="do:operate_expression"><xsl:with-param name="left" select="$_left"/><xsl:with-param name="op" select="$_op"/><xsl:with-param name="right" select="$_right"/></xsl:call-template></xsl:template><xsl:template name="do:match_condition_by_path"><xsl:param name="condition"/><xsl:param name="data_url"/><xsl:param name="data_gid"/><xsl:variable name="_cond_by_expath"><xsl:call-template name="do:expand_path_in_condition"><xsl:with-param name="condition" select="$condition"/></xsl:call-template></xsl:variable><xsl:choose><xsl:when test="string-length($data_url) = 0"><xsl:choose><xsl:when test="string-length($data_gid) = 0"><xsl:call-template name="do:match_condition_by_expath"><xsl:with-param name="condition" select="$_cond_by_expath"/></xsl:call-template></xsl:when><xsl:otherwise><xsl:for-each select="//attribute::node()[generate-id() = $data_gid]"><xsl:call-template name="do:match_condition_by_expath"><xsl:with-param name="condition" select="$_cond_by_expath"/></xsl:call-template></xsl:for-each><xsl:for-each select="//*[generate-id() = $data_gid]"><xsl:call-template name="do:match_condition_by_expath"><xsl:with-param name="condition" select="$_cond_by_expath"/></xsl:call-template></xsl:for-each></xsl:otherwise></xsl:choose></xsl:when><xsl:otherwise><xsl:for-each select="document($data_url, /)"><xsl:choose><xsl:when test="string-length($data_gid) = 0"><xsl:call-template name="do:match_condition_by_expath"><xsl:with-param name="condition" select="$_cond_by_expath"/></xsl:call-template></xsl:when><xsl:otherwise><xsl:for-each select="//attribute::node()[generate-id() = $data_gid]"><xsl:call-template name="do:match_condition_by_expath"><xsl:with-param name="condition" select="$_cond_by_expath"/></xsl:call-template></xsl:for-each><xsl:for-each select="//*[generate-id() = $data_gid]"><xsl:call-template name="do:match_condition_by_expath"><xsl:with-param name="condition" select="$_cond_by_expath"/></xsl:call-template></xsl:for-each></xsl:otherwise></xsl:choose></xsl:for-each></xsl:otherwise></xsl:choose></xsl:template><xsl:template name="do:operate_expression"><xsl:param name="left"/><xsl:param name="op"/><xsl:param name="right"/><xsl:choose><xsl:when test="$op = 'eq'"><xsl:if test="$left = $right"><xsl:value-of select="$ut:true"/></xsl:if></xsl:when><xsl:when test="$op = 'ne'"><xsl:if test="$left != $right"><xsl:value-of select="$ut:true"/></xsl:if></xsl:when><xsl:when test="$op = 'lt'"><xsl:if test="$left &lt; $right"><xsl:value-of select="$ut:true"/></xsl:if></xsl:when><xsl:when test="$op = 'le'"><xsl:if test="$left &lt;= $right"><xsl:value-of select="$ut:true"/></xsl:if></xsl:when><xsl:when test="$op = 'gt'"><xsl:if test="$left &gt; $right"><xsl:value-of select="$ut:true"/></xsl:if></xsl:when><xsl:when test="$op = 'ge'"><xsl:if test="$left &gt;= $right"><xsl:value-of select="$ut:true"/></xsl:if></xsl:when></xsl:choose></xsl:template></xsl:stylesheet>